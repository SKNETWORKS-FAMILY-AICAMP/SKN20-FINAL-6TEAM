# ===================
# Bizi 환경 변수
# ===================

# ===================
# DB 모드 선택
# - 로컬 DB: docker-compose -f docker-compose.local.yaml up --build
# - AWS DB:  docker-compose up --build
# ===================

# MySQL Database (AWS RDS) — docker-compose.yaml 에서 사용
# RDS 엔드포인트 예시: bizi-db.xxxxx.ap-northeast-2.rds.amazonaws.com
MYSQL_HOST=
MYSQL_PORT=3306

# Bastion Host (SSH 터널용 EC2 탄력적 IP) — AWS 모드에서만 필요
BASTION_HOST=
MYSQL_DATABASE=bizi_db
MYSQL_USER=
MYSQL_PASSWORD=

# 로컬 MySQL — docker-compose.local.yaml 에서 사용
# MYSQL_ROOT_PASSWORD=bizi1234
# MYSQL_USER=bizi
# MYSQL_PASSWORD=bizi1234

# JWT (Backend) — 필수, 32자 이상
# 생성: python -c "import secrets; print(secrets.token_urlsafe(48))"
JWT_SECRET_KEY=
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7

# Cookie
COOKIE_SECURE=false
COOKIE_SAMESITE=lax

# Test Login (set to true to enable /auth/test-login endpoint)
ENABLE_TEST_LOGIN=true

# Google OAuth2 (미구현 - 테스트 로그인 사용)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# Environment (development / production)
ENVIRONMENT=development

# OpenAI (RAG 서비스용)
OPENAI_API_KEY=your-openai-api-key

# ChromaDB (Docker 환경: 'chromadb' 컨테이너명 사용, 로컬 직접 실행: 비워두면 PersistentClient)
CHROMA_HOST=
CHROMA_PORT=8000
# ChromaDB 인증 토큰 (프로덕션 권장, 미설정 시 인증 비활성화)
# 생성: python -c "import secrets; print(secrets.token_urlsafe(32))"
CHROMA_AUTH_TOKEN=

# External APIs (지원사업 연동)
BIZINFO_API_KEY=your-bizinfo-api-key
KSTARTUP_API_KEY=your-kstartup-api-key
TAVILY_API_KEY=                    # Tavily 웹 검색 API 키 (RAG 서비스에서 사용)

# RAG API Key (설정 시 RAG 엔드포인트 인증 활성화, 비워두면 비활성화)
# 생성: python -c "import secrets; print(secrets.token_urlsafe(32))"
RAG_API_KEY=
ADMIN_API_KEY=                     # RAG 모니터링 엔드포인트 인증용 (비워두면 비활성화)

# Frontend (Docker+Nginx: /api | 로컬: http://localhost:8000)
VITE_API_URL=/api

# RAG Service Toggle
RAG_ENABLED=true  # Set to "false" to disable RAG service

# ===================
# RAG Feature Flags (ON/OFF 토글)
# ===================

# 검색 파이프라인
ENABLE_HYBRID_SEARCH=true
ENABLE_RERANKING=true
# ENABLE_CONTEXT_COMPRESSION=false
# ENABLE_ADAPTIVE_SEARCH=true
# ENABLE_DYNAMIC_K=true
# ENABLE_FIXED_DOC_LIMIT=true
# ENABLE_CROSS_DOMAIN_RERANK=true
# ENABLE_LEGAL_SUPPLEMENT=true

# 도메인 분류
# ENABLE_DOMAIN_REJECTION=true
ENABLE_VECTOR_DOMAIN_CLASSIFICATION=true
ENABLE_LLM_DOMAIN_CLASSIFICATION=false

# 평가 & 재시도
# ENABLE_LLM_EVALUATION=true
# ENABLE_RAGAS_EVALUATION=false
# ENABLE_POST_EVAL_RETRY=true
# ENABLE_GRADUATED_RETRY=true

# 인프라
# ENABLE_RESPONSE_CACHE=true
# ENABLE_RATE_LIMIT=true
# ENABLE_FALLBACK=true

# 생성
# ENABLE_ACTION_AWARE_GENERATION=true

# ===================
# RAG Pipeline Parameters
# ===================
VECTOR_SEARCH_WEIGHT=0.7
MULTI_QUERY_COUNT=2
MIN_DOC_EMBEDDING_SIMILARITY=0.2
RERANKER_TYPE=cross-encoder
CROSS_ENCODER_MODEL=BAAI/bge-reranker-base

# RAGAS 평가 모델 (기본값: gpt-4o-mini, text-embedding-3-small, 8192)
# RAGAS_LLM_MODEL=gpt-4o-mini
# RAGAS_EMBEDDING_MODEL=text-embedding-3-small
# RAGAS_MAX_TOKENS=8192

# 로그 레벨
# LOG_LEVEL=INFO

# Frontend RAG Streaming
VITE_RAG_STREAMING=true

# ===================
# RunPod Inference (선택)
# ===================
EMBEDDING_PROVIDER=local           # "local" (기본, CPU/GPU 로컬 모델) | "runpod" (RunPod GPU)
RUNPOD_API_KEY=                    # RunPod API 키 (rpa_xxx 형식)
RUNPOD_ENDPOINT_ID=                # RunPod Serverless Endpoint ID

UPSTAGE_API_KEY=

# ===================
# AWS S3 (공고 파일 저장)
# ===================
S3_BUCKET_NAME=                    # S3 버킷명 (미설정 시 파일 업로드 건너뜀)
AWS_DEFAULT_REGION=ap-northeast-2  # AWS 리전
# AWS_ACCESS_KEY_ID=               # 로컬 전용 (EC2에서는 IAM Role 자동 인증)
# AWS_SECRET_ACCESS_KEY=           # 로컬 전용
# S3_ENDPOINT_URL=http://localhost:4566  # LocalStack 사용 시 (로컬 테스트 전용)

# ===================
# 크롤링 스크립트 (선택)
# ===================
LAW_API_KEY=                       # 국가법령정보센터 API 키 (법률 데이터 크롤링용)

# ===================
# 알림 - AWS SES (EC2 Instance Role 자동 인증)
# EC2 IAM Role에 ses:SendEmail 권한 필요, 미설정 시 알림 건너뜀
# backend 모니터링 알림 + batch 배치 결과 알림 공통 사용
# ===================
AWS_REGION=ap-northeast-2          # SES 리전 (서울)
SES_FROM=                          # SES에서 검증(Verify)된 발신자 이메일
ALERT_EMAIL_TO=                    # 운영자 수신 이메일 (쉼표 구분으로 여러 명 가능)
ALERT_RESOURCE_THRESHOLD=90.0      # CPU/메모리/디스크 경고 임계치 (%)
